<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Catch the Letters Game</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: sans-serif;
      background: #cdeefd;
      user-select: none;
      touch-action: none;
    }
    #startScreen, #gameOver {
      position: absolute;
      width: 100%;
      height: 100%;
      background: #fff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 5;
    }
    #startScreen h1 {
      font-size: 2em;
    }
    #startButton {
      font-size: 1.5em;
      padding: 10px 20px;
      margin-top: 20px;
      background: pink;
      border: none;
      border-radius: 10px;
    }
    canvas {
      display: block;
    }
    #caughtDisplay {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1.5em;
      color: darkblue;
      z-index: 2;
    }
  </style>
</head>
<body>
  <div id="startScreen">
    <h1>🎮 Catch the letters of your name!</h1>
    <p>Catch them in the correct order using the pink basket.</p>
    <input type="text" id="nameInput" placeholder="Enter your name" />
    <button id="startButton">Start</button>
  </div>
  <div id="caughtDisplay"></div>
  <canvas id="gameCanvas"></canvas>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const startScreen = document.getElementById('startScreen');
    const startButton = document.getElementById('startButton');
    const nameInput = document.getElementById('nameInput');
    const caughtDisplay = document.getElementById('caughtDisplay');

    let letters = [];
    let caughtLetters = '';
    let basket = { x: 150, y: 550, width: 100, height: 30, color: 'pink' };
    let targetWord = '';
    let gameStarted = false;
    let fallInterval;

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    function randomX() {
      return Math.random() * (canvas.width - 40);
    }

    function spawnLetters() {
      if (caughtLetters.length < targetWord.length) {
        let allLetters = targetWord.split('').concat(generateDistractors(16));
        allLetters = shuffle(allLetters);
        letters = allLetters.map(letter => ({
          char: letter,
          x: randomX(),
          y: -Math.random() * 300,
          speed: 2 + Math.random() * 2,
          color: targetWord.includes(letter) ? 'orange' : 'gray'
        }));
      }
    }

    function generateDistractors(count) {
      const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      let result = [];
      while (result.length < count) {
        let rand = alphabet[Math.floor(Math.random() * alphabet.length)];
        if (!targetWord.includes(rand)) result.push(rand);
      }
      return result;
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function drawBasket() {
      ctx.fillStyle = basket.color;
      ctx.beginPath();
      ctx.arc(basket.x + basket.width / 2, basket.y + 10, basket.width / 2, 0, Math.PI, true);
      ctx.fill();
    }

    function drawLetters() {
      letters.forEach(letter => {
        ctx.fillStyle = letter.color;
        ctx.font = "32px Comic Sans MS";
        ctx.fillText(letter.char, letter.x, letter.y);
        letter.y += letter.speed;
      });
    }

    function detectCatch() {
      letters = letters.filter(letter => {
        if (
          letter.y + 20 >= basket.y &&
          letter.x > basket.x &&
          letter.x < basket.x + basket.width
        ) {
          if (letter.char === targetWord[caughtLetters.length]) {
            caughtLetters += letter.char;
            caughtDisplay.innerText = caughtLetters;
          }
          return false; // remove from screen
        }
        return letter.y < canvas.height + 20;
      });

      if (caughtLetters.length === targetWord.length) {
        clearInterval(fallInterval);
        setTimeout(() => {
          alert(`🎉 Good job, ${targetWord}! ❤️`);
          nextLevel();
        }, 500);
      }
    }

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawBasket();
      drawLetters();
      detectCatch();
    }

    function nextLevel() {
      caughtLetters = '';
      caughtDisplay.innerText = '';
      letters = [];
      if (!levelWords.length) {
        alert("You've finished all levels!");
        window.location.reload();
      } else {
        targetWord = levelWords.shift().toUpperCase();
        spawnLetters();
        fallInterval = setInterval(gameLoop, 30);
      }
    }

    let levelWords = [];

    startButton.onclick = () => {
      const name = nameInput.value.trim();
      if (!name) return alert("Enter a name to play.");
      targetWord = name.toUpperCase();
      levelWords = ["cat", "dog", "sun", "hat", "car", "bee", "red", "box", "cup", "pen", "bat", "map"].map(w => w.toUpperCase());
      startScreen.style.display = 'none';
      gameStarted = true;
      spawnLetters();
      fallInterval = setInterval(gameLoop, 30);
    };

    window.addEventListener('touchmove', e => {
      const touch = e.touches[0];
      basket.x = touch.clientX - basket.width / 2;
    });
  </script>
</body>
</html>