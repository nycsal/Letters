<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Maze Chase Game</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      overflow: hidden;
      font-family: Arial, sans-serif;
      height: 100%;
      touch-action: manipulation;
    }
    #game {
      display: block;
      background: #111;
      border: 4px solid #fff;
      margin: 0 auto;
      max-width: 100%;
      height: auto;
    }
    #joystick {
      position: fixed;
      bottom: 10px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      gap: 10px;
      z-index: 10;
    }
    .btn {
      width: 60px;
      height: 60px;
      background: #333;
      color: #fff;
      font-size: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      border: 2px solid white;
    }
    @media (max-width: 500px) {
      .btn {
        width: 50px;
        height: 50px;
        font-size: 20px;
      }
    }
  </style>
</head>
<body>

<canvas id="game" width="400" height="400"></canvas>

<div id="joystick">
  <div class="btn" onclick="move('up')">‚Üë</div>
  <div class="btn" onclick="move('left')">‚Üê</div>
  <div class="btn" onclick="move('down')">‚Üì</div>
  <div class="btn" onclick="move('right')">‚Üí</div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const size = 20;
const mapWidth = 20;
const mapHeight = 20;

let level = 1;
let map = [];
let player = { x: 1, y: 1 };
let ghost = { x: 18, y: 18 };
let direction = { x: 0, y: 0 };
let pelletsLeft = 0;

const levels = [
  [
    "####################",
    "#........#.........#",
    "#.####.#.#.###.###.#",
    "#.#....#.#...#.....#",
    "#.#.##.#.#####.###.#",
    "#.#....#.....#...#.#",
    "#.######.###.###.#.#",
    "#........#.#.....#.#",
    "###.####.#.#######.#",
    "#.....#..#.........#",
    "#.###.#.#####.#####E",
    "#.#.....#...#.#.....",
    "#.#.#####.#.#.#.###.",
    "#.#.....#.#.#.#.#.#.",
    "#.#####.#.#.#.#.#.#.",
    "#.....#.#...#.#.#.#.",
    "#####.#.#####.#.#.#.",
    "#.....#.......#.#.#.",
    "#.#############.#.#.",
    "#P...............G#"
  ]
];

function loadLevel(n) {
  let layout = levels[n - 1];
  map = [];
  pelletsLeft = 0;
  for (let y = 0; y < mapHeight; y++) {
    let row = [];
    for (let x = 0; x < mapWidth; x++) {
      let ch = layout[y][x];
      if (ch === "P") {
        player = { x, y };
        row.push(".");
        pelletsLeft++;
      } else if (ch === "G") {
        ghost = { x, y };
        row.push(".");
        pelletsLeft++;
      } else if (ch === "E") {
        row.push("E");
      } else {
        row.push(ch);
        if (ch === ".") pelletsLeft++;
      }
    }
    map.push(row);
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for (let y = 0; y < mapHeight; y++) {
    for (let x = 0; x < mapWidth; x++) {
      const cell = map[y][x];
      if (cell === "#") {
        ctx.fillStyle = "#555";
        ctx.fillRect(x * size, y * size, size, size);
      } else if (cell === ".") {
        ctx.fillStyle = "#ff0";
        ctx.beginPath();
        ctx.arc(x * size + size / 2, y * size + size / 2, 3, 0, Math.PI * 2);
        ctx.fill();
      } else if (cell === "E") {
        ctx.fillStyle = "#0f0";
        ctx.fillRect(x * size + 5, y * size + 5, size - 10, size - 10);
      }
    }
  }

  // Player
  ctx.fillStyle = "#0ff";
  ctx.beginPath();
  ctx.arc(player.x * size + size / 2, player.y * size + size / 2, 8, 0, Math.PI * 2);
  ctx.fill();

  // Ghost
  ctx.fillStyle = "#f00";
  ctx.beginPath();
  ctx.arc(ghost.x * size + size / 2, ghost.y * size + size / 2, 8, 0, Math.PI * 2);
  ctx.fill();
}

function move(dir) {
  const moves = {
    up: { x: 0, y: -1 },
    down: { x: 0, y: 1 },
    left: { x: -1, y: 0 },
    right: { x: 1, y: 0 }
  };
  direction = moves[dir];
}

function update() {
  const nx = player.x + direction.x;
  const ny = player.y + direction.y;
  if (map[ny] && map[ny][nx] && map[ny][nx] !== "#") {
    player.x = nx;
    player.y = ny;
    if (map[ny][nx] === ".") {
      map[ny][nx] = " ";
      pelletsLeft--;
    } else if (map[ny][nx] === "E") {
      alert("üéâ You completed the level!");
      level = 1;
      loadLevel(level);
      return;
    }
  }

  // Ghost chase
  let dx = ghost.x - player.x;
  let dy = ghost.y - player.y;
  if (Math.abs(dx) > Math.abs(dy)) {
    ghost.x += dx > 0 ? -1 : 1;
  } else {
    ghost.y += dy > 0 ? -1 : 1;
  }
  if (map[ghost.y][ghost.x] === "#") {
    ghost.x -= dx > 0 ? -1 : 1;
    ghost.y -= dy > 0 ? -1 : 1;
  }

  if (ghost.x === player.x && ghost.y === player.y) {
    alert("üíÄ You got caught!");
    loadLevel(level);
  }

  draw();
}

loadLevel(level);
draw();
setInterval(update, 400);
</script>
</body>
</html>